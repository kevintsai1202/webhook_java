# Webhook 工具專案任務清單

## 專案資訊
- **專案名稱**: Webhook 工具
- **技術棧**: Spring Boot 3.x + H2 Database
- **建立日期**: 2025-11-25

---

## 任務狀態說明
- ✅ 已完成 (Completed)
- 🔄 進行中 (In Progress)
- ⏳ 待處理 (Pending)
- ❌ 已取消 (Cancelled)

---

## 階段 1: 專案規劃與文件準備

| 任務 | 狀態 | 負責人 | 完成日期 | 備註 |
|-----|------|--------|---------|------|
| 分析需求並創建規格文件 (spec.md) | ✅ | Claude | 2025-11-25 | 包含架構、資料模型、流程圖等 |
| 創建 API 文件 (api.md) | ✅ | Claude | 2025-11-25 | RESTful API 設計完成 |
| 創建任務清單 (todolist.md) | 🔄 | Claude | - | 當前文件 |

---

## 階段 2: 專案初始化

| 任務 | 狀態 | 負責人 | 完成日期 | 備註 |
|-----|------|--------|---------|------|
| 初始化 Spring Boot 專案結構 | ⏳ | - | - | 使用 Maven 構建工具 |
| 設定 pom.xml 依賴項 | ⏳ | - | - | Spring Boot, JPA, H2, Lombok 等 |
| 創建專案目錄結構 | ⏳ | - | - | controller/service/repository/entity |
| 設定 application.yml 配置檔 | ⏳ | - | - | H2 資料庫、JPA、Server 配置 |

---

## 階段 3: 資料層實作

| 任務 | 狀態 | 負責人 | 完成日期 | 備註 |
|-----|------|--------|---------|------|
| 創建 WebhookMessage 實體類別 | ⏳ | - | - | JPA @Entity 標註 |
| 創建 WebhookRepository 介面 | ⏳ | - | - | 繼承 JpaRepository |
| 測試資料庫連線 | ⏳ | - | - | 確認 H2 資料庫正常運作 |

---

## 階段 4: 業務邏輯層實作

| 任務 | 狀態 | 負責人 | 完成日期 | 備註 |
|-----|------|--------|---------|------|
| 創建 WebhookService 介面 | ⏳ | - | - | 定義業務方法 |
| 實作 WebhookServiceImpl | ⏳ | - | - | 實作儲存、查詢、刪除邏輯 |
| 實作 HTTP 請求資訊提取邏輯 | ⏳ | - | - | 提取 headers, body, IP 等 |

---

## 階段 5: 控制器層實作

| 任務 | 狀態 | 負責人 | 完成日期 | 備註 |
|-----|------|--------|---------|------|
| 創建 WebhookController | ⏳ | - | - | 處理 webhook 接收端點 |
| 實作 POST /webhook/** 端點 | ⏳ | - | - | 接收任意路徑的 webhook |
| 實作 GET /webhook/messages 端點 | ⏳ | - | - | 查詢所有記錄 (分頁) |
| 實作 GET /webhook/messages/{id} 端點 | ⏳ | - | - | 查詢單筆記錄 |
| 實作 DELETE /webhook/messages/{id} 端點 | ⏳ | - | - | 刪除記錄 |

---

## 階段 6: 回應物件與異常處理

| 任務 | 狀態 | 負責人 | 完成日期 | 備註 |
|-----|------|--------|---------|------|
| 創建統一回應物件 (WebhookResponse) | ⏳ | - | - | 包含 status, message, data |
| 實作全域異常處理器 | ⏳ | - | - | @ControllerAdvice |
| 實作自訂異常類別 | ⏳ | - | - | WebhookNotFoundException 等 |

---

## 階段 7: 測試

| 任務 | 狀態 | 負責人 | 完成日期 | 備註 |
|-----|------|--------|---------|------|
| 撰寫 WebhookService 單元測試 | ⏳ | - | - | 使用 JUnit 5 + Mockito |
| 撰寫 WebhookController 單元測試 | ⏳ | - | - | 使用 MockMvc |
| 撰寫 WebhookRepository 整合測試 | ⏳ | - | - | @DataJpaTest |
| 執行所有測試並確認通過 | ⏳ | - | - | mvn test |

---

## 階段 8: 整合測試與驗證

| 任務 | 狀態 | 負責人 | 完成日期 | 備註 |
|-----|------|--------|---------|------|
| 啟動應用程式 | ⏳ | - | - | mvn spring-boot:run |
| 測試 POST /webhook/** 功能 | ⏳ | - | - | 使用 cURL 或 Postman |
| 測試查詢功能 | ⏳ | - | - | GET /webhook/messages |
| 測試刪除功能 | ⏳ | - | - | DELETE /webhook/messages/{id} |
| 驗證 H2 Console 功能 | ⏳ | - | - | http://localhost:8080/h2-console |
| 檢查資料是否正確儲存 | ⏳ | - | - | 透過 H2 Console 查詢 |

---

## 階段 9: 文件與程式碼優化

| 任務 | 狀態 | 負責人 | 完成日期 | 備註 |
|-----|------|--------|---------|------|
| 補充程式碼註解 | ✅ | Claude | 2025-11-25 | 函式級別中文註解 |
| 創建 README.md | ✅ | Claude | 2025-11-25 | 專案說明、安裝步驟、使用範例 |
| 程式碼審查與重構 | ⏳ | - | - | 確保符合最佳實踐 |

---

## 階段 10: Webhook 主動推送功能規劃（新增）

| 任務 | 狀態 | 負責人 | 完成日期 | 備註 |
|-----|------|--------|---------|------|
| 更新 spec.md 規格文件 | ✅ | Claude | 2025-11-25 | 新增推送目標、推送記錄資料模型 |
| 更新 api.md API 文件 | ✅ | Claude | 2025-11-25 | 新增推送相關 API 端點 |
| 更新 todolist.md 任務清單 | 🔄 | Claude | - | 新增開發任務 |

---

## 階段 11: 推送目標管理實作

| 任務 | 狀態 | 負責人 | 完成日期 | 備註 |
|-----|------|--------|---------|------|
| 創建 WebhookTarget 實體類別 | ⏳ | - | - | JPA @Entity，包含所有欄位 |
| 創建 WebhookTargetRepository 介面 | ⏳ | - | - | 繼承 JpaRepository |
| 創建 WebhookTargetService 介面與實作 | ⏳ | - | - | CRUD 操作邏輯 |
| 創建 WebhookTargetController | ⏳ | - | - | RESTful API 端點 |
| 撰寫 WebhookTarget 單元測試 | ⏳ | - | - | Service 和 Controller 測試 |

---

## 階段 12: 推送記錄管理實作

| 任務 | 狀態 | 負責人 | 完成日期 | 備註 |
|-----|------|--------|---------|------|
| 創建 WebhookDelivery 實體類別 | ⏳ | - | - | JPA @Entity，關聯 Message 和 Target |
| 創建 WebhookDeliveryRepository 介面 | ⏳ | - | - | 繼承 JpaRepository，自訂查詢方法 |
| 創建 WebhookDeliveryService 介面與實作 | ⏳ | - | - | 推送邏輯、狀態更新 |
| 實作 HTTP 請求發送功能 | ⏳ | - | - | 使用 RestTemplate 或 WebClient |
| 撰寫 WebhookDelivery 單元測試 | ⏳ | - | - | Service 測試，Mock HTTP 請求 |

---

## 階段 13: 手動推送功能實作

| 任務 | 狀態 | 負責人 | 完成日期 | 備註 |
|-----|------|--------|---------|------|
| 在 WebhookController 新增推送端點 | ⏳ | - | - | POST /webhook/messages/{id}/deliver |
| 實作推送邏輯 | ⏳ | - | - | 選擇目標、建立 Delivery、發送請求 |
| 新增推送歷史查詢端點 | ⏳ | - | - | GET /webhook/deliveries |
| 新增推送記錄詳情查詢端點 | ⏳ | - | - | GET /webhook/deliveries/{id} |
| 新增訊息推送記錄查詢端點 | ⏳ | - | - | GET /webhook/messages/{id}/deliveries |
| 撰寫推送功能整合測試 | ⏳ | - | - | 測試完整推送流程 |

---

## 階段 14: 自動轉發功能實作

| 任務 | 狀態 | 負責人 | 完成日期 | 備註 |
|-----|------|--------|---------|------|
| 配置非同步任務執行器 | ⏳ | - | - | @EnableAsync 配置 |
| 實作自動轉發邏輯 | ⏳ | - | - | 接收訊息後觸發 |
| 實作路徑匹配過濾 | ⏳ | - | - | 正則表達式匹配 |
| 更新 WebhookService | ⏳ | - | - | 整合自動轉發功能 |
| 撰寫自動轉發測試 | ⏳ | - | - | 測試觸發條件和執行 |

---

## 階段 15: 推送功能整合測試

| 任務 | 狀態 | 負責人 | 完成日期 | 備註 |
|-----|------|--------|---------|------|
| 測試推送目標 CRUD 功能 | ⏳ | - | - | 使用 cURL 或 Postman |
| 測試手動推送功能 | ⏳ | - | - | 推送成功/失敗場景 |
| 測試自動轉發功能 | ⏳ | - | - | 驗證匹配規則和執行 |
| 測試推送歷史查詢 | ⏳ | - | - | 分頁、篩選功能 |
| 驗證資料庫記錄 | ⏳ | - | - | 透過 H2 Console 檢查 |
| 執行完整測試套件 | ⏳ | - | - | mvn test 確保全部通過 |

---

## 階段 16: 文件更新與優化

| 任務 | 狀態 | 負責人 | 完成日期 | 備註 |
|-----|------|--------|---------|------|
| 更新 README.md | ⏳ | - | - | 新增推送功能說明 |
| 補充程式碼註解 | ⏳ | - | - | 新增類別的中文註解 |
| 程式碼審查與重構 | ⏳ | - | - | 優化推送邏輯和錯誤處理 |
| 效能測試與優化 | ⏳ | - | - | 測試高併發推送場景 |

---

## 問題與風險追蹤

| 問題描述 | 嚴重程度 | 狀態 | 解決方案 | 更新日期 |
|---------|---------|------|---------|---------|
| - | - | - | - | - |

---

## 備註
- 每個任務完成後需更新此文件
- 遇到問題需記錄在「問題與風險追蹤」區塊
- 測試失敗需回退狀態並修正問題
- 完成所有測試後才能進行下一階段
